- [はじめに](#はじめに)
- [制限](#制限)
  - [VMware](#vmware)
  - [mdx1 Web UI](#mdx1-web-ui)
    - [表示](#表示)
    - [検索](#検索)
    - [サマリ表示](#サマリ表示)
  - [Windowsで使えない文字列](#windowsで使えない文字列)
  - [macOSで使えない文字列](#macosで使えない文字列)
- [命名規則](#命名規則)
  - [case 1](#case-1)
  - [case 2](#case-2)
  - [case 3](#case-3)
  - [case 4](#case-4)
    - [OSの種類](#osの種類)
  - [case 5](#case-5)
  - [case 6](#case-6)

# はじめに
mdx1におけるVMの命名規則について記す。

mdx1のVM名について、ユーザ自身で作成しなければいけない。
自由度が高く、利用者のグループや利用機関のルールに従って、命名することができる。
その一方で、mdx1の固有の制限や使い勝手もあるため、ある程度のmdx1に沿った形での命名規約を定めることも必要である。
本稿では、mdx1におけるVM命名規則の事例として記す。

# 制限
VMを命名するにあたり、制限が二つ存在する。仮想化基盤のハイパーバイザ側の制約と、mdx1のWebインターフェースや利用上に遭遇する制約である。

## VMware
mdx1で採用されているハイパーバイザーはVMwareであり、VMwareの制約がそのまま当てはまる。
以下はVMwareにおける命名規則の制約である

- 文字数制限: 最大80文字
- 使用可能な文字: 英数字（A-Z、a-z、0-9）、ハイフン（-）、アンダースコア（_）、およびピリオド（.）
- 特殊文字の制限: スペースやその他の特殊文字（例：@、#、$、%など）は使用できない
  - なぜかmdx1上では使える
  - 禁則が `/`のみとなってるが、スペースや`\`も使えない
  - `\`は`%5c`になる
- 一意性: 一意の名前である必要がある

## mdx1 Web UI
mdx1のダッシュボードの表示と検索には以下の制約がある

### 表示
- 表示フォント: Metropolis, "Avenir Next", "Helvetica Neue"
  - プロポーショナルフォントのため可変
- 表示文字数
  - i: 80文字以上
  - w: 27文字
  - W: 21文字
  - 1: 62文字
  - 0: 31文字
  - _: 37文字

### 検索
- 単文字列のみ
- マッチングしたのもの
- ワイルドカードや正規表現は不可能

### サマリ表示
- OSのバージョンは表示されない
- ESXiでサポートされていないOSはotherになってしまう
- VM内の情報は表示されない
  - Lustreのマウント状況はわからない
- 用途やブートオーダー、ステージなどのVMに対する記述を付記することができない

## Windowsで使えない文字列
- 予約文字: `<>:"/\|?*`
- 先頭文字: `.\`
- 末尾文字: `.`
- 予約名: CON,PRN,AUX,NUL,COM0,COM1,COM2,COM3,COM4,COM5,COM6,COM7,COM8,COM9,COM¹,COM²,COM³,LPT0,LPT1,LPT2,LPT3,LPT4,LPT5,LPT6,LPT7,LPT8,LPT9,LPT¹,LPT²,LPT³

## macOSで使えない文字列
- Windowsと共通
- 文字列: `:`, `.`, `/`

# 命名規則
エクスポート先やOS間の互換性を考慮すると、 `ISO 9660`に準拠させる

- 最大名前長: 31文字
- 使用可能文字: [a-z][A-Z][0-9]_
- 文字列の規則: スネークケース、一部キャメルケース
- `_`で区切った各ケースに必要な情報を記述する

## case 1
- 文字数: 2
- 使用文字種: [0-9]
- 用途: ソート用

> [!NOTE]
> ソート用の番号の使い方は随意だが、2桁にしておくとエレベータソートを使える。30台のブロックを3つ使える。不足する場合は、[a-z]も使用すれば、36x36のソートが可能。

## case 2
- 文字数: 3
- 使用文字種: [0-9]
- 用途: VMの設定フラグ
- 1文字目: BIOS/UEFI/セキュアブートの有りなし
  - 0: BIOS
  - 1: UEFI w/o セキュアブート
  - 2: UEFI w セキュアブート
- 2文字目: Lustreの設定
  - 0: Lustreオフ
  - 1: Lustreオン
  - 2: Lustreオフ, autofs
  - 3: Lustreオン, autofs
  - 4: Lustreオフ, acl
  - 5: Lustreオン, acl
  - 6: Lustreオフ, autofs, acl
  - 7: Lustreオン, autofs, acl
- 3文字目: VMのステージ
  - 0: 原型
  - 1: 開発
  - 2: テスト
  - 3: 本番
  - 4: 作業中
  - 5: 検討中
  - 6: 休止
  - 9: 廃棄

## case 3
- 文字数: 13
- 使用文字種: [a-z][A-Z][0-9]
- 用途: VMの用途や説明
- 文字列規則: 単語の区切りを明確にするため、限定的にキャメルケースを使う

## case 4
- 文字数: 4
- 使用文字種: [a-z]
- 用途: 4文字に省略したOSの種別

### OSの種類
| OS名       | words | 略   |
| ---------- | ----- | ---- |
| almalinux  | 9     | alma |
| centos     | 6     | cent |
| debian     | 6     | debi |
| deepin     | 6     | deep |
| fedora     | 6     | fedo |
| gentoo     | 6     | gent |
| ipfire     | 6     | ipfi |
| kali       | 4     | kali |
| knoppix    | 7     | knop |
| linuxmint  | 9     | mint |
| manjaro    | 7     | manj |
| mxlinux    | 7     | mxlx |
| opensuse   | 8     | suse |
| plamo      | 5     | plam |
| porteus    | 7     | prts |
| remi       | 4     | remi |
| rocky      | 5     | rock |
| oracle     | 6     | orac |
| scientific | 10    | scie |
| slackware  | 9     | slac |
| springdale | 10    | sprg |
| ubuntu     | 6     | ubnt |
| windows    | 7     | wind |

## case 5
- 文字数: 2
- 使用文字種: [0-9]
- 用途: OSのメジャーバージョン

## case 6
- 文字数: 2
- 使用文字種: [0-9]
- 用途: OSのマイナーバージョン

> [!NOTE]
> case 4-6はVMにインストールされているOSの詳細を明記する。mdx1ではバージョンまで追跡できない
