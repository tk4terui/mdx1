
# はじめに
主要ディストリビューションは仮想化基盤向けにVMイメージが提供されている。
これらのVMイメージを利用することで、mdx1上でISOからのインストールを省略することができる。
VMイメージの仮想ハードディスクは、特定の仮想化基盤向けにフォーマットされている必要がある。
動作対象とする仮想化基盤向けにフォーマットされたVMイメージは複数用意されている。
ただし、すべての仮想化基盤を対象に用意されているとは限らない。
ユーザーや市場の需要、コミュニティの方針により、商用仮想化基盤について用意されていない場合もある。

mdx1の場合は、VMware ESXiを使用しているため、OVFとVMDKの組合せたVMイメージ必要になる。
VMDKはVMware用の仮想ハードディスクで、OVFは仮想マシンの構成が定義された設定ファイルである。
これらをアーカイブ化したものがOVAで、OVAを伸長することで、OVFとVMDKの組合せを得ることができる。
また、VMware WorkStationを利用することで、ユーザのローカル環境でVMを作成してから、エクスポートすることで独自のOVFとVMDKを得ることも可能である。

VMware自体は2023年11月にBroadcomに買収されてから、ESXiの提供は終了し、ライセンス費用は高騰化、ユーザーにとって不安定な環境になっている。
そのため、昨今では脱VMwareの潮流が形成され、ディストリビューションとしてVMware用のVMイメージを提供する動機が弱まっている。

脱VMwareの候補の一つとして、OpenStackが存在する。オープンソースの仮想環境として歴史と認知度があり、ディストリビューションによる商用サポートも提供されている。
オンプレミスの仮想化基盤として構築されている実績もあり、ベンダーロックインの回避のため、選択されている。
実際にmdx2では、OpenStackによる仮想化基盤が構築された。

これら以外に、オンプレミスで採用されている仮想化基盤として、マイクロソフトのWindows ServerによるHyper-Vがある。

そして、ディストリビューションから、OpenStackやHyper-V向けのVMイメージや仮想ハードディスクが提供されている。

ユーザー側では、以下のような問題が発生する。
- mdx1やmdx2では異なる仮想化基盤が利用されている
- ユーザーの所属機関ではさらに異なるハイパーバイザが利用されている場合もある
- 複数の仮想化環境を動作環境とした場合、ユーザーで開発環境や検証環境を用意することは大きな負担となる

そのため、ユーザー側で用意する仮想化基盤は少なくし、仮想マシンのインポートとエクスポートで複数の仮想化基盤に対応できる方が理想である。
しかし、単一の仮想化基盤の機能だけで、異なる仮想化基盤の相互運用できるようにするには限界がある。
そのため、仮想化基盤に依らずに、異なる仮想化基盤への移行方法や、マルチ環境を考慮した開発体制を整えておく必要がある。

本稿では、異なる仮想化環境に対応した、VMイメージや仮想ハードディスクの相互変換方法について記す。
Linux上で利用可能なオープンソースのソフトウェアのみを利用する。

# 対象Linux 

# 利用ソフトウェア
- `qemu-img`
- `open-vmdk`

